\include{begin}
\include{lecture_SigSys_formulas}
\title{Data Fusion\\
An Intuitive Look}  
\author{Dr Salman Aslam}
\date{} 



%##################################
\begin{document}
%##################################
\begin{frame}[plain]\pw\Large
\vspace{0.8in}
\titlepage
\end{frame}

\begin{frame}[plain]\pw\Large
\frametitle{\textbf{Sequence}}
\setcounter{tocdepth}{1}
\tableofcontents
\end{frame} 

\begin{frame}[plain]\pw\Large
\frametitle{\textbf{Sequence : detailed}}
\setcounter{tocdepth}{2}
\tableofcontents%[pausesections]
\end{frame} 

%###############
\section{Introduction}
%###############

%=================
\subsection{Notation}
%=================
\begin{frame}\pw\Large
\frametitle{Overview}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_1_Notation-1.pdf}
\end{figure}
\end{frame}


\begin{frame}\pw\Large
\frametitle{Overview}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_1_Notation-2.pdf}
\end{figure}
\end{frame}



\begin{frame}\pw\Large
\frametitle{Overview}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_1_Notation-3.pdf}
\end{figure}
\end{frame}



\begin{frame}\pw\Large
\frametitle{Overview}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_1_Notation-4.pdf}
\end{figure}
\end{frame}

%=================
\subsection{Problem Statement}
%=================
\begin{frame}\pw\Large
\frametitle{Overview}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_2_ProblemStatement-1.pdf}
\end{figure}
\end{frame}



\begin{frame}\pw\Large
\frametitle{Overview}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_2_ProblemStatement-2.pdf}
\end{figure}
\end{frame}


%\begin{frame}\pw\Large
%\frametitle{Overview}
%\framesubtitle{}
%Combine {\color{red}expert opinion} and  {\color{red}observations} to come up with better {\color{green}understanding}
%\end{frame}



%###############
\section{Graphical Solution}
%###############
%=================
\subsection{Start}
%=================
\begin{frame}\pw\Large
\frametitle{Old Understanding}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_Process-0.pdf}
\end{figure}
\end{frame}



%=================
\subsection{Step 1}
%=================
\begin{frame}\pw\Large
\frametitle{Expectations}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_Process-1.pdf}
\end{figure}
\end{frame}


%=================
\subsection{Step 2}
%=================
\begin{frame}\pw\Large
\frametitle{Observations}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_Process-2.pdf}
\end{figure}
\end{frame}


%=================
\subsection{Step 3}
%=================
\begin{frame}\pw\Large
\frametitle{New Understanding}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_Process-3.pdf}
\end{figure}
\end{frame}


\begin{frame}\pw\Large
\frametitle{New Understanding}
\framesubtitle{}
\begin{figure}
\includegraphics[width=0.95\textwidth]{figs/WFAR11_UCP_Update_Prediction_Process-4.pdf}
\end{figure}
\end{frame}

%###############
\section{Mathematical Solution}
%###############
%=================
\subsection{Scalar Case}
%=================
\begin{frame}\pw\Large
\frametitle{Derivation of Scalar Case}
\framesubtitle{}
Let $p_1$ and $p_2$ be two Gaussian pdfs:
\begin{equation*}
\begin{array}{llll}
p_1(x; \muone, \sone)&=\frac{1}{\sqrt{2 \pi \varone}} e^{-\frac{(x-\muone)^2}{2 \varone}}\\
p_2(x; \mutwo, \stwo)&=\frac{1}{\sqrt{2 \pi \vartwo}} e^{-\frac{(x-\mutwo)^2}{2 \vartwo}}\\\\
\end{array}
\end{equation*}
Their product is:
\begin{equation*}
\begin{array}{llll}
p_1p_2 &=     \frac{1}{\sqrt{2 \pi \varone}} e^{-\frac{(x-\muone)^2}{2 \varone}}    \frac{1}{\sqrt{2 \pi \vartwo}} e^{-\frac{(x-\mutwo)^2}{2 \vartwo}}\\\\
\end{array}
\end{equation*}
where ${\color{Orange}K}=\frac{C\varone}{C^2\varone + \vartwo}$
\end{frame}



%\begin{frame}\pw\Large
%\frametitle{Derivation of Scalar Case}
%\framesubtitle{}
%Combining exponents
%\begin{equation*}
%\begin{array}{llll}
%&=\frac{1}{\sqrt{2 \pi \varone \vartwo 2 \pi }}         e^{ -\frac{(x-\muone)^2}{2 \varone} - \frac{(x-\mutwo)^2}{2 \vartwo} } \\\\
%\end{array}
%\end{equation*}
%Taking LCM
%\begin{equation*}
%\begin{array}{llll}
%&=    \frac{1}{\sqrt{2 \pi \varone \vartwo 2 \pi }}         e^{ \frac{ - \vartwo (x-\muone)^2 - \varone (x-\mutwo)^2 } { 2 \varone \vartwo } }\\
%\end{array}
%\end{equation*}
%\end{frame}



\begin{frame}\pw\Large
\frametitle{Derivation of Scalar Case}
\framesubtitle{}
$p_1p_2$ will be a Gaussian function with mean
\begin{equation*}
\begin{array}{rlllllll}
\mufused &= \frac { \muone \vartwo + \mutwo \varone }{\varone + \vartwo}\\
 &= \frac { \muone \vartwo + \mutwo C\varone }{C^2\varone + \vartwo}\\
&=\muone + \frac{\varone(C\mutwo-C^2\muone)}{C^2\varone + \vartwo}\\
&=\muone + \frac{C\varone(\mutwo-C\muone)}{C^2\varone + \vartwo} =\muone  + {\color{Orange}K}(\mutwo-C\muone)
\end{array}
\end{equation*}
\end{frame}





\begin{frame}\pw\Large
\frametitle{Derivation of Scalar Case}
\framesubtitle{}
And variance
\begin{equation*}
\begin{array}{rlllllll}
\varfused
&= \frac{\varone \vartwo}{\varone + \vartwo}\\
&= \frac{\varone \vartwo}{C^2\varone + \vartwo}\\
&=\varone - \frac{C^2\color{red}\sigma^4_1}{C^2\varone + \vartwo}\\
&=\varone-\frac{C\varone}{C^2\varone + \vartwo}C\varone\\
&=(1-{\color{Orange}K}C)\varone\\\\
\end{array}
\end{equation*}
where ${\color{Orange}K}$ is the same as defined in the previous slide
\end{frame}



%=================
\subsection{Comparison With Vector Case}
%=================
\begin{frame}\pw\Large
\frametitle{One-to-one Correspondence}
\framesubtitle{}
\begin{figure}[h]
\centering
\includegraphics[width=1.07\textwidth]{figs/TRK_KalmanFilter_equations-2D.pdf}
\end{figure}
\end{frame}




%###############
\section{Programmatical Solution}
%###############

\begin{frame}[fragile, allowframebreaks]\pw\Large
\frametitle{Matlab Code}
\framesubtitle{}

\scriptsize
The code below implements 2 time steps for the train:
\tinyvvv \begin{lstlisting}[language=Matlab]
clear;clc;clf;

%initialization
x           =   -5:0.1:25;  %x axis
A           =   2;          %state transition matrix
B           =   5;          %control input matrix
C           =   1;          %transformation matrix
u           =   1;          %control input
Q           =   1.2;        %process noise variance, adds uncertainty to prediction
mu_2        =   [7 14];     %the output of the radio ranging system at next two times
var_2       =   1;          %the variance of the radio ranging system given by manufacturer

mu_f        =   0;          %the estimated location of the train at current time, k=0
var_f       =   1;          %the estimated variance of our estimate at current time, k=0

pdf_0       =   (1/sqrt(2*pi*var_f))*exp(-(0.5/var_f)*(x-mu_f).^2);


%=====================================
%run Kalman Filter
%=====================================
for k=1:2
    %predict
    mu_1        =   A*mu_f      +   B*u;
    var_1       =   A^2*var_f   +   Q;
    %update
    K           =   (C*var_1)/(C^2*var_1 + var_2);
    mu_f        =   mu_1 + K*(mu_2(k)-C*mu_1);
    var_f       =   (1-K*C)*var_1;
    
    pred        =   (1/sqrt(2*pi*var_1))*exp(-(0.5/var_1)*(x-mu_1).^2);
    meas        =   (1/sqrt(2*pi*var_2))*exp(-(0.5/var_2)*(x-mu_2(k)).^2);
    fused       =   (1/sqrt(2*pi*var_f))*exp(-(0.5/var_f)*(x-mu_f).^2);
    
                    axis([-5 25 0 0.5]); 
                    grid on;
                    hold on;


                    plot(x,pred, 'r--x');
                    plot(x,meas, 'b--o');
                    plot(x,fused,'g--.')
                    plot(x,pdf_0,'g--.');                    
end
legend('predicted', 'measured', 'fused')
xlabel('railway track (meters), direction along which train is traveling ->')
ylabel('belief in fused/predicted/measured position of train')
title('Data fusion using the Kalman Filter')
\end{lstlisting}
\end{frame}








\begin{frame}\pw\Large
\frametitle{Results}
\framesubtitle{}
The code on the previous slide produces this output:
\begin{figure}[h]
\centering
\includegraphics[width=0.47\textwidth]{figs/CONTROLS_Kalman_train_example.pdf}
\caption{\tiny In this example, a train is moving along the x-axis.  The problem begins at time $kT=0$ sec when our initial estimate of the train is that it is standing at $x=0$ meters.  The prediction and measurements for the next two time instants, $kT=1$ sec and $kT=2$ sec are shown.  We assume for simplicity but without loss of generality, that $T=1$~sec, and therefore we use $k$ (in sec) to depict time.  It may be mentioned that the version of the Kalman filter for continuous time is called the Kalman-Bucy filter.}
\end{figure}
\end{frame}


%###############
\appendix
%###############
\begin{frame}\Large
\frametitle{}
\framesubtitle{}
Questions
\end{frame}

%##################################
\end{document}
%##################################